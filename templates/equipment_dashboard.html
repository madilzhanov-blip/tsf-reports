{% extends "base.html" %}

{% block title %}–£—á–µ—Ç —Ç–µ—Ö–Ω–∏–∫–∏ - –î–∞—à–±–æ—Ä–¥{% endblock %}

{% block content %}
<div class="card">
    <h2>üìä –î–∞—à–±–æ—Ä–¥ —É—á–µ—Ç–∞ —Ç–µ—Ö–Ω–∏–∫–∏</h2>
    <p style="color: #666; margin-bottom: 30px;">–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é —Ç–µ—Ö–Ω–∏–∫–∏</p>
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="/equipment/new_report" class="btn btn-success">‚ûï –ù–æ–≤—ã–π —Å–º–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</a>
        <a href="/equipment/reports" class="btn btn-primary">üìã –í—Å–µ –æ—Ç—á–µ—Ç—ã</a>
        <a href="/equipment/statistics" class="btn btn-info">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
        <a href="/equipment/export" class="btn btn-warning">üì§ –≠–∫—Å–ø–æ—Ä—Ç Excel</a>
    </div>
    
    <!-- –ö–ü–≠ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    {% if dashboard_data.latest_report %}
    <div class="stats-grid">
        <div class="stat-card" style="background: #3498db;">
            <div class="stat-number">{{ dashboard_data.latest_report.totals.total_working }}</div>
            <div>–¢–µ—Ö–Ω–∏–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ</div>
        </div>
        
        <div class="stat-card" style="background: #2ecc71;">
            <div class="stat-number">{{ dashboard_data.latest_report.totals.efficiency_percent }}%</div>
            <div>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
        </div>
        
        <div class="stat-card" style="background: #f39c12;">
            <div class="stat-number">{{ dashboard_data.latest_report.totals.total_waiting }}</div>
            <div>–í –æ–∂–∏–¥–∞–Ω–∏–∏</div>
        </div>
        
        <div class="stat-card" style="background: #e74c3c;">
            <div class="stat-number">{{ dashboard_data.latest_report.totals.total_repair }}</div>
            <div>–í —Ä–µ–º–æ–Ω—Ç–µ</div>
        </div>
    </div>
    {% endif %}
    
    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç -->
    {% if dashboard_data.latest_report %}
    <div class="card" style="margin-bottom: 30px;">
        <h3>üïê –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç</h3>
        <p><strong>–î–∞—Ç–∞:</strong> {{ dashboard_data.latest_report.date }} | 
           <strong>–°–º–µ–Ω–∞:</strong> {{ dashboard_data.latest_report.shift }} |
           <strong>–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä:</strong> {{ dashboard_data.latest_report.inspector_name }}</p>
        
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>–¢–µ—Ö–Ω–∏–∫–∞</th>
                        <th>–í—Å–µ–≥–æ</th>
                        <th>–í —Ä–∞–±–æ—Ç–µ</th>
                        <th>%</th>
                        <th>–û–∂–∏–¥–∞–Ω–∏–µ</th>
                        <th>–†–µ–º–æ–Ω—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipment in dashboard_data.latest_report.equipment_data %}
                    <tr>
                        <td><strong>{{ equipment.type }}</strong></td>
                        <td>{{ equipment.available }}</td>
                        <td>{{ equipment.working }}</td>
                        <td>
                            {% set efficiency = (equipment.working / equipment.available * 100) if equipment.available > 0 else 0 %}
                            <span class="badge badge-{% if efficiency >= 70 %}success{% elif efficiency >= 50 %}warning{% else %}danger{% endif %}">
                                {{ "%.1f"|format(efficiency) }}%
                            </span>
                        </td>
                        <td>{{ equipment.waiting }}</td>
                        <td>{{ equipment.repair }}</td>
                        <td>
                            <small>
                                {% if equipment.no_operator > 0 %}–ë–µ–∑ –º–µ—Ö.: {{ equipment.no_operator }}<br>{% endif %}
                                {% if equipment.no_fuel > 0 %}–ë–µ–∑ —Ç–æ–ø–ª–∏–≤–∞: {{ equipment.no_fuel }}{% endif %}
                            </small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–µ—Ö–Ω–∏–∫–∏ -->
    <div class="card">
        <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 30 –¥–Ω–µ–π</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            {% for equipment_type, stats in dashboard_data.statistics.items() %}
            {% if stats.total_shifts > 0 %}
            <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">{{ equipment_type }}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                    <div><strong>–°–º–µ–Ω:</strong> {{ stats.total_shifts }}</div>
                    <div><strong>–°—Ä. –≤ —Ä–∞–±–æ—Ç–µ:</strong> {{ stats.avg_working }}</div>
                    <div><strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> 
                        <span class="badge badge-{% if stats.avg_efficiency >= 70 %}success{% elif stats.avg_efficiency >= 50 %}warning{% else %}danger{% endif %}">
                            {{ stats.avg_efficiency }}%
                        </span>
                    </div>
                    <div><strong>–û–±—â–∏–π –º–∞–∫—Å.:</strong> {{ equipment_types[equipment_type].max_count }}</div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    color: white;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    margin-bottom: 10px;
}

.badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.badge-success { background: #28a745; color: white; }
.badge-warning { background: #ffc107; color: black; }
.badge-danger { background: #dc3545; color: white; }
.badge-info { background: #17a2b8; color: white; }

.table-container {
    overflow-x: auto;
}
</style>
{% endblock %}