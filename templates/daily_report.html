<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –õ–û–ì–û–¢–ò–ü–ê */
        .header-content {
            display: flex;
            align-items: left;
            justify-content: left;
            gap: 20px;
        }

        .logo {
            height: 100px;
            width: auto;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .section-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .dynamic-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .dynamic-table th,
        .dynamic-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .dynamic-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .dynamic-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .dynamic-table input,
        .dynamic-table select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .photo-upload {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            border-color: #764ba2;
            background: #e9ecef;
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .photo-item .caption {
            padding: 10px;
            background: white;
        }

        .photo-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content"></div>
                <img src="{{ url_for('static', filename='images/logo5.png') }}" 
                     alt="TSF Reports Logo" 
                     class="logo">
            <h1>Daily report</h1>
            <p>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–¥–∑–æ—Ä–∞ –∑–∞–∫–∞–∑—á–∏–∫–∞</p>
        </div>


        <div class="content">
            <form id="dailyReportForm" action="{{ url_for('daily_report') }}" method="POST">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="section">
                    <h2 class="section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="report_date">–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞:</label>
                            <input type="date" id="report_date" name="report_date" required>
                        </div>
                        <div class="form-group">
                            <label for="shift">–°–º–µ–Ω–∞:</label>
                            <select id="shift" name="shift" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–º–µ–Ω—É</option>
                                <option value="Dshift">–î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</option>
                                <option value="Nshift">–ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="project_name">–ü—Ä–æ–µ–∫—Ç:</label>
                            <select id="project_name" name="project_name" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</option>
                                <option value="–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –•–≤–æ—Å—Ç–æ–≤–æ–≥–æ –•–æ–∑—è–π—Å—Ç–≤–∞ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–∞ –ú–û–§-3">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –•–≤–æ—Å—Ç–æ–≤–æ–≥–æ –•–æ–∑—è–π—Å—Ç–≤–∞ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–∞ –ú–û–§-3</option>
                                <option value="other">–î—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                            <input type="text" id="location" name="location" value="–ê–ª–º–∞–ª—ã–∫" required>
                        </div>
                        <div class="form-group">
                            <label for="author">–ê–≤—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞:</label>
                            <select id="author" name="author" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞</option>
                                <option value="–ê–¥–∏–ª–∂–∞–Ω–æ–≤ –ú.–ê">–ê–¥–∏–ª–∂–∞–Ω–æ–≤ –ú.–ê</option>
                                <option value="–ê—Ö–º–∞–¥–æ–≤ –ê.–ù">–ê—Ö–º–∞–¥–æ–≤ –ê.–ù</option>
                                <option value="–†–∞—Å—É–ª–æ–≤ –î.–ñ">–†–∞—Å—É–ª–æ–≤ –î.–ñ</option>
                                <option value="–¢–µ–Ω –ê.–í">–¢–µ–Ω –ê.–í</option>
                                <option value="other">–î—Ä—É–≥–æ–π</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="weather">–ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</label>
                            <input type="text" id="weather" name="weather" class="form-control" readonly>
                            <button type="button" onclick="loadWeather()" class="btn btn-sm btn-secondary mt-1">üå§Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É</button>
                        </div>
                        <script>
                        function loadWeather() {
                            fetch('/api/weather')
                                .then(response => response.json())
                                .then(data => {
                                    document.getElementById('weather').value = data.weather;
                                })
                                .catch(error => {
                                    console.error('–û—à–∏–±–∫–∞:', error);
                                    document.getElementById('weather').value = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã';
                                });
                        }
                        document.addEventListener('DOMContentLoaded', function() {
                            loadWeather();
                        });
                        </script>
                    </div>
                </div>


                         

                                </tr>
                                
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-success" onclick="addEquipmentRow()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É</button>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª:</h2>
                <div class="form-group">
                            
                            <input type="text" id="personnel" name="personnel" value="–°–º. –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ–¥—Ä—è–¥—á–∏–∫–∞" required>
                </div>
                
                </div>
                <div class="section">
                    <h2 class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞:</h2>
                <div class="form-group">
                            
                            <input type="text" id="material_placement" name="material_placement" value="–°–º. –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ–¥—Ä—è–¥—á–∏–∫–∞" required>
                </div>
                
                <!-- –í—ã–ø–æ–ª–Ω—è–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã -->
                </div>
                <div class="section">
                    <h2 class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å / –í—ã–ø–æ–ª–Ω—è–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã</h2>
                    <div class="table-container">
                        <table class="dynamic-table" id="worksTable">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–£—á–∞—Å—Ç–æ–∫</th>
                                    <th>–ü–ö –æ—Ç</th>
                                    <th>–ü–ö –¥–æ</th>
                                    <th>–í–∏–¥ —Ä–∞–±–æ—Ç—ã</th>
                                    <th>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="work-number">1</span></td>
                                    <td><input type="text" name="work_area[]" placeholder="–í–∑–∏–°-2" required></td>
                                    <td><input type="text" name="work_ch_from[]" placeholder="21+00"></td>
                                    <td><input type="text" name="work_ch_to[]" placeholder="22+00"></td>
                                    <td>
                                        <select name="work_type[]" required>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ä–∞–±–æ—Ç—ã</option>
                                            <option value="–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                                            <option value="–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏">–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</option>
                                            <option value="–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                                        </select>
                                    </td>
                                    <td><textarea name="work_description[]" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ä–∞–±–æ—Ç" required></textarea></td>
                                    <td><button type="button" class="btn btn-danger" onclick="removeWorkRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-success" onclick="addWorkRow()">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É</button>
                    </div>
                </div>
                
                <!-- –ü–æ—Å—Ç–∞–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                <div class="section">
    <h2 class="section-title">–ü–æ—Å—Ç–∞–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h2>
    <div class="table-container">
        <table class="dynamic-table" id="materials_delivery">
            <thead>
                <tr>
                    <th>‚Ññ</th>
                    <th>–û—Ç–≤–∞–ª/–∫–∞—Ä—å–µ—Ä</th>
                    <th>–í–∏–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="work-number">1</span></td>
                    <td><input type="text" name="material_area[]" placeholder="–û—Ç–≤–∞–ª 1" ></td>
                    <td><input type="text" name="material_type[]" placeholder="–°—É–ø–µ—Å—å/–ì–ì–ì"></td>
                    <td><textarea name="material_description[]" placeholder="–û—Ç–≤–∞–ª ‚Ññ1 –ø—Ä–æ–≤–µ—Ä–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω–æ, –æ—Ç–æ–±—Ä–∞–Ω–∞ –ø—Ä–æ–±–∞" ></textarea></td>                                                  
                    <td><button type="button" class="btn btn-danger" onclick="removeMDRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
            </tbody>
        </table>
        <button type="button" class="btn btn-success" onclick="addMDRow()">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–∞–ª/–∫–∞—Ä—å–µ—Ä</button>
    </div>
</div>


                <!-- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ -->
                <div class="section">
    <h2 class="section-title">–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞</h2>
    <div class="table-container">
        <table class="dynamic-table" id="quality_control">
            <thead>
                <tr>
                    <th>‚Ññ</th>
                    <th>–£—á–∞—Å—Ç–æ–∫</th>
                    <th>–ü–ö –æ—Ç</th>
                    <th>–ü–ö –¥–æ</th>
                    <th>–ò–Ω—Å–ø–µ–∫—Ü–∏—è –Ω–∞ –≤–∏–¥—ã —Ä–∞–±–æ—Ç—ã</th>
                    <th>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å–ø–µ–∫—Ü–∏–∏</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="work-number">1</span></td>
                    <td><input type="text" name="qc_area[]" placeholder="–°–µ–≤–µ—Ä–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ –¥–∞–º–±—ã,–í–∑–∏–°-2" required></td>
                    <td><input type="text" name="qc_ch_from[]" placeholder="21+00"></td>
                    <td><input type="text" name="qc_ch_to[]" placeholder="22+00"></td>
                    <td>
                        <select name="qc_work_type[]" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ä–∞–±–æ—Ç—ã</option>
                            <option value="–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                            <option value="–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏">–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</option>
                            <option value="–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                            <option value="–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å">–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</option>
                        </select>
                    </td>
                    <td><textarea name="qc_description[]" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ä–∞–±–æ—Ç" required></textarea></td>
                    <td><button type="button" class="btn btn-danger" onclick="removeQCRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
            </tbody>
        </table>
        <button type="button" class="btn btn-success" onclick="addQCRow()">–î–æ–±–∞–≤–∏—Ç—å QC</button>
    </div>
</div>

                <!-- –ó–∞–º–µ—á–∞–Ω–∏—è -->
                <div class="section">
                    <h2 class="section-title">–ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ–¥—Ä—è–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
                    <div class="form-group">
                        <textarea id="remarks" name="remarks" rows="4" placeholder="–ó–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"></textarea>
                    </div>
                </div>

                <!-- –§–æ—Ç–æ –æ—Ç—á–µ—Ç—ã -->
                <div class="section">
                    <h2 class="section-title">–§–æ—Ç–æ –æ—Ç—á–µ—Ç—ã</h2>
                    <div class="photo-upload" onclick="document.getElementById('photo_input').click()">
                        <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
                        <p style="color: #666; font-size: 0.9rem;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, JPEG</p>
                        <input type="file" id="photo_input" multiple accept="image/*" onchange="handlePhotoUpload(event)">
                    </div>
                    <div id="photo_preview" class="photo-preview"></div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="saveAsDraft()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫</button>
                    <button type="button" class="btn btn-primary" onclick="previewReport()">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                    <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã
        document.getElementById('report_date').value = new Date().toISOString().split('T')[0];



    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ –∏—Ç–æ–≥–æ–≤ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º



    function calculateColumnTotals() {
    const table = document.getElementById('equipmentTable');
    const rows = table.querySelectorAll('tbody tr:not(.total-row)'); // –ò—Å–∫–ª—é—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    
    // –ú–∞—Å—Å–∏–≤—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—É–º–º –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ–ª–±—Ü—É
    const totals = {
        damba: 0,
        vodovod: 0,
        gpp: 0,
        pulpovod: 0,
        raspred: 0,
        total_equipment: 0,
        total_site: 0,
    };
    
    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º (–∫—Ä–æ–º–µ –∏—Ç–æ–≥–æ–≤–æ–π)
    rows.forEach(row => {
        const dambaInput = row.querySelector('input[name="damba[]"]');
        const vodovodInput = row.querySelector('input[name="vodovod[]"]');
        const gppInput = row.querySelector('input[name="gpp[]"]');
        const pulpovodInput = row.querySelector('input[name="pulpovod[]"]');
        const raspredInput = row.querySelector('input[name="raspred[]"]');
        const rowTotalInput = row.querySelector('input[name="row_total[]"]');
         
        let rowSum = 0;
        if (dambaInput) { rowSum += parseInt(dambaInput.value) || 0; totals.damba += parseInt(dambaInput.value) || 0; }
        if (vodovodInput) { rowSum += parseInt(vodovodInput.value) || 0; totals.vodovod += parseInt(vodovodInput.value) || 0; }
        if (gppInput) { rowSum += parseInt(gppInput.value) || 0; totals.gpp += parseInt(gppInput.value) || 0; }
        if (pulpovodInput) { rowSum += parseInt(pulpovodInput.value) || 0; totals.pulpovod += parseInt(pulpovodInput.value) || 0; }
        if (raspredInput) { rowSum += parseInt(raspredInput.value) || 0; totals.raspred += parseInt(raspredInput.value) || 0; }

        if (rowTotalInput) {
            rowTotalInput.value = rowSum;
        }
    });

    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –ø–æ–ª—è
    const totalDamba = document.getElementById('total_damba');
    const totalVodovod = document.getElementById('total_vodovod');
    const totalGpp = document.getElementById('total_gpp');
    const totalPulpovod = document.getElementById('total_pulpovod');
    const totalRaspred = document.getElementById('total_raspred');
    const total_site = document.getElementById('total_site');
    
    if (totalDamba) totalDamba.value = totals.damba;
    if (totalVodovod) totalVodovod.value = totals.vodovod;
    if (totalGpp) totalGpp.value = totals.gpp;
    if (totalPulpovod) totalPulpovod.value = totals.pulpovod;
    if (totalRaspred) totalRaspred.value = totals.raspred;
    if (total_site) total_site.value = totals.damba + totals.vodovod + totals.gpp + totals.pulpovod + totals.raspred;
}


// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é addEquipmentRow
function addEquipmentRow() {
    const table = document.getElementById('equipmentTable').getElementsByTagName('tbody')[0];
    const totalRow = table.querySelector('.total-row'); // –ù–∞—Ö–æ–¥–∏–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    
    const newRow = table.insertRow(totalRow ? totalRow.rowIndex - 1 : -1); // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π
    newRow.innerHTML = `
        <td><input type="text" name="equipment_name[]" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏" required></td>
        <td><input type="number" name="damba[]" min="0" onchange="calculateColumnTotals()"></td>
        <td><input type="number" name="vodovod[]" min="0" onchange="calculateColumnTotals()"></td>
        <td><input type="number" name="gpp[]" min="0" onchange="calculateColumnTotals()"></td>
        <td><input type="number" name="pulpovod[]" min="0" onchange="calculateColumnTotals()"></td>
        <td><input type="number" name="raspred[]" min="0" onchange="calculateColumnTotals()"></td>
        <td><button type="button" class="btn btn-danger" onclick="removeEquipmentRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
    `;
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é removeEquipmentRow
function removeEquipmentRow(button) {
    const row = button.parentNode.parentNode;
    row.parentNode.removeChild(row);
    calculateColumnTotals(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—è–º
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—è–º –≤–≤–æ–¥–∞
    const existingInputs = document.querySelectorAll('#equipmentTable input[type="number"]:not([readonly])');
    existingInputs.forEach(input => {
        input.addEventListener('change', calculateColumnTotals);
    });
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏
    calculateColumnTotals();
});
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ö–Ω–∏–∫–∏
        function addEquipmentRow() {
            const table = document.getElementById('equipmentTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" name="equipment_name[]" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏" ></td>
                <td><input type="number" name="damba[]"  ></td>
                <td><input type="number" name="vodovod[]"  ></td>
                <td><input type="number" name="gpp[]"  ></td>
                <td><input type="number" name="pulpovod[]"  ></td>
                <td><input type="number" name="raspred[]"  ></td>
                <td><button type="button" class="btn btn-danger" onclick="removeEquipmentRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
            `;
        }
        function calculateTotal(input) {
            const row = input.closest('tr');
            const numbers = row.querySelectorAll('input[type="number"]:not([name="total[]"])');
            const totalInput = row.querySelector('input[name="total[]"]');
    
            let sum = 0;
            numbers.forEach(num => {
                sum += parseInt(num.value) || 0;
        });
    
         totalInput.value = sum;
        }
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ö–Ω–∏–∫–∏
        function removeEquipmentRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ä–∞–±–æ—Ç
        function addWorkRow() {
    const table = document.getElementById('worksTable').getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();
    const rowCount = table.rows.length;
    
    newRow.innerHTML = `
        <td><span class="work-number">${rowCount}</span></td>
        <td><input type="text" name="work_area[]" placeholder="–£—á–∞—Å—Ç–æ–∫" required></td>
        <td><input type="text" name="work_ch_from[]" placeholder="–ü–ö –æ—Ç"></td>
        <td><input type="text" name="work_ch_to[]" placeholder="–ü–ö –¥–æ"></td>
        <td>
            <select name="work_type[]" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ä–∞–±–æ—Ç—ã</option>
                <option value="–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                <option value="–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏">–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</option>
                <option value="–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
            </select>
        </td>
        <td><textarea name="work_description[]" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç" required></textarea></td>
        <td><button type="button" class="btn btn-danger" onclick="removeWorkRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
    `;
    updateWorkNumbers();
}
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ QC
        function addQCRow() {
    const table = document.getElementById('quality_control').getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();
    const rowCount = table.rows.length;
    
    newRow.innerHTML = `
        <td><span class="work-number">${rowCount}</span></td>
        <td><input type="text" name="qc_area[]" placeholder="–£—á–∞—Å—Ç–æ–∫" required></td>
        <td><input type="text" name="qc_ch_from[]" placeholder="–ü–ö –æ—Ç"></td>
        <td><input type="text" name="qc_ch_to[]" placeholder="–ü–ö –¥–æ"></td>
        <td>
            <select name="qc_work_type[]" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ä–∞–±–æ—Ç—ã</option>
                <option value="–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                <option value="–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏">–ñ/–± –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</option>
                <option value="–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å">–í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å</option>
                <option value="–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">–ú–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
            </select>
        </td>
        <td><textarea name="qc_description[]" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç" required></textarea></td>
        <td><button type="button" class="btn btn-danger" onclick="removeQCRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
    `;
    updateWorkNumbers();
}
         // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏
        function addMDRow() {
    const table = document.getElementById('materials_delivery').getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();
    const rowCount = table.rows.length;
    
    newRow.innerHTML = `
        <td><span class="work-number">${rowCount}</span></td>
        <td><input type="text" name="material_area[]" placeholder="–û—Ç–≤–∞–ª 1" required></td>
        <td><input type="text" name="material_type[]" placeholder="–°—É–ø–µ—Å—å/–ì–ì–ì"></td>
        <td><textarea name="material_description[]" placeholder="–û—Ç–≤–∞–ª ‚Ññ1 –ø—Ä–æ–≤–µ—Ä–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω–æ, –æ—Ç–æ–±—Ä–∞–Ω–∞ –ø—Ä–æ–±–∞" required></textarea></td>
        <td><button type="button" class="btn btn-danger" onclick="removeMDRow(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
    `;
    updateWorkNumbers();
}
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ä–∞–±–æ—Ç
        function removeWorkRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateWorkNumbers();
        }
         // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ QC
        function removeQCRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateWorkNumbers();
        }
         // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ MD
        function removeMDRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateWorkNumbers();
        }
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç
        function updateWorkNumbers() {
            const numbers = document.querySelectorAll('.work-number');
            numbers.forEach((num, index) => {
                num.textContent = index + 1;
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        function handlePhotoUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('photo_preview');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'photo-item';
                    photoDiv.innerHTML = `
                        <button type="button" class="remove-btn" onclick="removePhoto(this)">&times;</button>
                        <img src="${e.target.result}" alt="–§–æ—Ç–æ ${preview.children.length + 1}">
                        <div class="caption">
                            <input type="text" placeholder="–ü–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" name="photo_captions[]">
                        </div>
                    `;
                    preview.appendChild(photoDiv);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        function removePhoto(button) {
            const photoItem = button.parentNode;
            photoItem.parentNode.removeChild(photoItem);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
        function saveAsDraft() {
            const formData = new FormData(document.getElementById('dailyReportForm'));
            localStorage.setItem('dailyReportDraft', JSON.stringify(Object.fromEntries(formData)));
            alert('–ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ!');
        }

        // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
        function previewReport() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        }

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('dailyReportForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!validateForm()) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–∞–∫ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
    const photoItems = document.querySelectorAll('.photo-item img');
    photoItems.forEach((img, index) => {
        if (img.src.startsWith('data:')) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = `photo_data_${index}`;
            input.value = img.src;
            this.appendChild(input);
        }
    });
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
    this.submit();
});

// –§—É–Ω–∫—Ü–∏—è —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function compressImage(file, maxWidth = 800, quality = 0.7) {
    return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            let { width, height } = img;
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // –†–∏—Å—É–µ–º —Å–∂–∞—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            ctx.drawImage(img, 0, 0, width, height);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64 —Å —Å–∂–∞—Ç–∏–µ–º
            resolve(canvas.toDataURL('image/jpeg', quality));
        };
        
        img.src = URL.createObjectURL(file);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
async function handlePhotoUpload(event) {
    const files = event.target.files;
    const preview = document.getElementById('photo_preview');
    
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        try {
            // –°–∂–∏–º–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const compressedDataUrl = await compressImage(file, 800, 0.7);
            
            const photoDiv = document.createElement('div');
            photoDiv.className = 'photo-item';
            photoDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removePhoto(this)">&times;</button>
                <img src="${compressedDataUrl}" alt="–§–æ—Ç–æ ${preview.children.length + 1}">
                <div class="caption">
                    <input type="text" placeholder="–ü–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" name="photo_captions[]">
                </div>
            `;
            preview.appendChild(photoDiv);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
        }
    }
}


        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validateForm() {
            const requiredFields = document.querySelectorAll('[required]');
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    return false;
                }
            }
            return true;
        }




</script>
</body>
</html>