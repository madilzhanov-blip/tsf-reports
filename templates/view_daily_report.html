<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ежедневный отчет #{{ report.id }}</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .header-section {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .section-card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        .info-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            width: 30%;
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        .logo {
            height: 80px;
            width: auto;
        }
        .equipment-table, .works-table {
            font-size: 0.9rem;
        }
        .navbar-brand { font-weight: bold; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="fas fa-clipboard-check"></i> Система инспекций
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('dashboard') }}">
                    <i class="fas fa-home"></i> Главная
                </a>
                <a class="nav-link" href="{{ url_for('daily_report_list') }}">
                    <i class="fas fa-list"></i> Список отчетов
                </a>
                <a class="nav-link" href="{{ url_for('daily_report') }}">
                    <i class="fas fa-plus"></i> Новый отчет
                </a>
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-sign-out-alt"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Заголовок отчета -->
        <div class="header-section text-center">
            <h2>Ежедневный отчет от технического надзора(CIVIL)</h2>
            <h6>Общестроительные работы</h6>      
            <div class="header-content">
                <img src="{{ url_for('static', filename='images/logo5.png') }}" 
                     alt="TSF Reports Logo" 
                     class="logo">
            </div>
        </div>

        <!-- Основная информация -->
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Основная информация</h5>
            </div>
            <div class="card-body">
                <table class="table info-table">
                    <tr>
                        <th>Дата отчета:</th>
                        <td>{{ report.report_date or 'Не указано' }}</td>
                    </tr>
                    <tr>
                        <th>Проект:</th>
                        <td>{{ report.project_name or 'Не указано' }}</td>
                    </tr>
                    <tr>
                        <th>Местоположение:</th>
                        <td>{{ report.location or 'Не указано' }}</td>
                    </tr>
                    <tr>
                        <th>Автор отчета:</th>
                        <td>{{ report.author or 'Не указано' }}</td>
                    </tr>
                    <tr>
                        <th>Погодные условия:</th>
                        <td>{{ report.weather or 'Не указано' }}</td>
                    </tr>
                    <tr>
                        <th>Смена:</th>
                        <td>
                            {% if report.shift == 'Dshift' %}
                               Дневная смена
                            {% elif report.shift == 'Nshift' %}
                               Ночная смена
                            {% else %}
                                {{ report.shift or 'Не указано' }}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Создан:</th>
                        <td>{{ report.created_at or 'Не указано' }} ({{ report.inspector_name or 'Неизвестно' }})</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Техника -->
{% if report.equipment_data and report.equipment_data.names %}
<div class="card section-card">
    <div class="card-header section-header">
        <h5 class="mb-0"><i class="fas fa-cogs"></i> Задействованность техники</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped equipment-table">
                <thead class="table-dark">
                    <tr>
                        <th>Техника</th>
                        <th>Пионерная дамба</th>
                        <th>Водовод оборотной воды</th>
                        <th>ГПП-1 ПС 110/10кВ</th>
                        <th>Магистральный пульповод</th>
                        <th>Распределительный пульповод</th>
                        <th>Всего техники</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in range(report.equipment_data.names|length) %}
                        {% if report.equipment_data.names[i] %}
                        <tr {% if report.equipment_data.names[i] == "Всего по участку" %}class="table-warning fw-bold"{% endif %}>
                            <td><strong>{{ report.equipment_data.names[i] }}</strong></td>
                            <td>{{ report.equipment_data.damba[i] if i < report.equipment_data.damba|length else '0' }}</td>
                            <td>{{ report.equipment_data.vodovod[i] if i < report.equipment_data.vodovod|length else '0' }}</td>
                            <td>{{ report.equipment_data.gpp[i] if i < report.equipment_data.gpp|length else '0' }}</td>
                            <td>{{ report.equipment_data.pulpovod[i] if i < report.equipment_data.pulpovod|length else '0' }}</td>
                            <td>{{ report.equipment_data.raspred[i] if i < report.equipment_data.raspred|length else '0' }}</td>
                            <td>
    <strong>
    {% if report.equipment_data.names[i] == "Всего по участку" %}
        {{ report.equipment_data.total_site[0] if report.equipment_data.total_site and report.equipment_data.total_site|length > 0 else '0' }}
    {% else %}
        {{ report.equipment_data.total[i] if i < report.equipment_data.total|length and report.equipment_data.total[i] != '' else '0' }}
    {% endif %}
    </strong>
</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>   
            </table>
        </div>
    </div>
</div>
{% endif %}

        <!-- НОВЫЙ РАЗДЕЛ: Персонал -->
        {% if report.personnel %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-users"></i> Персонал</h5>
            </div>
            <div class="card-body">
                <p>{{ report.personnel }}</p>
            </div>
        </div>
        {% endif %}

        <!-- НОВЫЙ РАЗДЕЛ: Прогресс размещения материала -->
        {% if report.material_placement %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-layer-group"></i> Прогресс размещения материала</h5>
            </div>
            <div class="card-body">
                <p>{{ report.material_placement }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Выполняемые работы -->
        {% if report.works_data and report.works_data.areas %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-hard-hat"></i> Прогресс / Выполняемые работы</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped works-table">
                        <thead class="table-dark">
                            <tr>
                                <th>№</th>
                                <th>Участок</th>
                                <th>ПК от</th>
                                <th>ПК до</th>
                                <th>Вид работы</th>
                                <th>Описание работ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(report.works_data.areas|length) %}
                                {% if report.works_data.areas[i] %}
                                <tr>
                                    <td><span class="badge bg-primary">{{ i + 1 }}</span></td>
                                    <td><strong>{{ report.works_data.areas[i] }}</strong></td>
                                    <td>{{ report.works_data.ch_from[i] if i < report.works_data.ch_from|length else '-' }}</td>
                                    <td>{{ report.works_data.ch_to[i] if i < report.works_data.ch_to|length else '-' }}</td>
                                    <td>{{ report.works_data.work_types[i] if i < report.works_data.work_types|length else '-' }}</td>
                                    <td>{{ report.works_data.work_descriptions[i] if i < report.works_data.work_descriptions|length else '-' }}</td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ОБНОВЛЕННЫЙ РАЗДЕЛ: Поставка материалов (теперь таблица) -->
        {% if report.materials_data and report.materials_data.areas %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-truck"></i> Поставка материалов</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>№</th>
                                <th>Отвал/карьер</th>
                                <th>Вид материала</th>
                                <th>Описание</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(report.materials_data.areas|length) %}
                                {% if report.materials_data.areas[i] %}
                                <tr>
                                    <td><span class="badge bg-success">{{ i + 1 }}</span></td>
                                    <td><strong>{{ report.materials_data.areas[i] }}</strong></td>
                                    <td>{{ report.materials_data.material_types[i] if i < report.materials_data.material_types|length else '-' }}</td>
                                    <td>{{ report.materials_data.descriptions[i] if i < report.materials_data.descriptions|length else '-' }}</td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ОБНОВЛЕННЫЙ РАЗДЕЛ: Контроль качества (теперь таблица) -->
        {% if report.quality_data and report.quality_data.areas %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-check-circle"></i> Контроль качества</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>№</th>
                                <th>Участок</th>
                                <th>ПК от</th>
                                <th>ПК до</th>
                                <th>Инспекция на виды работы</th>
                                <th>Описание инспекции</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(report.quality_data.areas|length) %}
                                {% if report.quality_data.areas[i] %}
                                <tr>
                                    <td><span class="badge bg-info">{{ i + 1 }}</span></td>
                                    <td><strong>{{ report.quality_data.areas[i] }}</strong></td>
                                    <td>{{ report.quality_data.ch_from[i] if i < report.quality_data.ch_from|length else '-' }}</td>
                                    <td>{{ report.quality_data.ch_to[i] if i < report.quality_data.ch_to|length else '-' }}</td>
                                    <td>{{ report.quality_data.work_types[i] if i < report.quality_data.work_types|length else '-' }}</td>
                                    <td>{{ report.quality_data.descriptions[i] if i < report.quality_data.descriptions|length else '-' }}</td>
                                </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Замечания -->
        {% if report.remarks %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Замечания подрядной организации</h5>
            </div>
            <div class="card-body">
                <p>{{ report.remarks }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Фото отчеты -->
        {% if report.photos_data %}
        <div class="card section-card">
            <div class="card-header section-header">
                <h5 class="mb-0"><i class="fas fa-camera"></i> Фото отчеты</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for photo in report.photos_data %}
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <img src="{{ photo.data }}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="Фото {{ loop.index }}">
                            <div class="card-body p-2">
                                <small class="text-muted">{{ photo.caption or 'Фото ' + loop.index|string }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Действия -->
        <div class="text-center mb-4">
            <a href="{{ url_for('daily_report_list') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Назад к списку
            </a>
            <button class="btn btn-warning" onclick="editReport({{ report.id }})">
                <i class="fas fa-edit"></i> Редактировать
            </button>
            <button class="btn btn-outline-info" onclick="window.print()">
                <i class="fas fa-print"></i> Печать
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        function editReport(reportId) {
            alert('Редактирование отчета #' + reportId + ' (будет реализован позже)');
        }
    </script>
</body>
</html>